resource "helm_release" "cve-consumer" {
  depends_on = [var.eks_cluster_name]

  name       = "webapp-cve-consumer"
  repository = "git+https://github.com/csye7125-su24-team08/helm-webapp-cve-consumer.git"
  chart      = "helm-webapp-cve-consumer" # Relative path to the chart directory in the repo
  version    = "1.5.0"                    # Specify the version of the Helm chart

  create_namespace = true
  namespace        = "cve-consumer"

  set {
    name  = "imagePullSecrets.dockerConfig"
    value = var.dockerCreds
  }

  set {
    name  = "db_secrets.flyway.password"
    value = base64encode(var.postgresPassword)
  }



}
